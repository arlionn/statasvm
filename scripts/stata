#!/bin/sh
# a wrapper for Stata to make it more behave like a Unix interpreter:
# - the last argument is a .do file to run
# - optional first argument of -q, which is passed into Stata's -q
# - the output is sent to stdout
# But because of how Stata is hard-coded
# 1) if you script is named script.do and you happen to have script.log in the current directory, it will be stomped
# 2) you won't see output until the entire script is finished

# TODO: try to auto-locate Stata based on platform, and pull the corresponding spaghetti code out of test.mk
# TODO: write Stata.bat so this works on Wandows too


if [ "$1" = "-q" ]; then
  Q="-q"
  shift
fi

if [ "$#" -gt 1 ]; then
  echo "Wrong number of arguments" >&2
  exit 1
fi

INPUT="$1"; shift

OUTPUT=$(basename "$INPUT" | sed 's/.do$/.log/')

stata $Q -e "$INPUT"
cat "$OUTPUT"
rm "$OUTPUT"
